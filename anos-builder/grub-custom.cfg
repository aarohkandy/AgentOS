set timeout=0

loadfont unicode

# Minimalist GRUB config to avoid "Out of Memory"
# Only load what is absolutely necessary

# EFI-Only GRUB Configuration
# Simplified for compatibility

set timeout=5
set timeout_style=menu

menuentry "Install ANOS" {
    search --file --set=root /casper/vmlinuz
    linux /casper/vmlinuz boot=casper file=/cdrom/preseed/kubuntu.seed maybe-ubiquity quiet splash ---
    initrd /casper/initrd
}

menuentry "Install ANOS (Safe Graphics)" {
    search --file --set=root /casper/vmlinuz
    linux /casper/vmlinuz boot=casper file=/cdrom/preseed/kubuntu.seed maybe-ubiquity nomodeset quiet splash ---
    initrd /casper/initrd
}
menuentry "OEM install (for manufacturers)" {
	# Removed set gfxpayload=keep
	search --file --set=root /casper/vmlinuz
	linux	/casper/vmlinuz boot=casper file=/cdrom/preseed/kubuntu.seed maybe-ubiquity quiet splash oem-config/enable=true ---
	initrd	/casper/initrd
}

# Fix for VirtualBox Legacy BIOS "Out of Memory" error
menuentry "Install ANOS (Legacy/BIOS Fix)" {
	search --file --set=root /casper/vmlinuz
	linux16	/casper/vmlinuz boot=casper file=/cdrom/preseed/kubuntu.seed maybe-ubiquity quiet splash ---
	initrd16 /casper/initrd
}
if [ "$grub_platform" = "efi" ]; then
menuentry 'Boot from next volume' {
	exit 1
}
menuentry 'UEFI Firmware Settings' {
	fwsetup
}
else
menuentry 'Test memory' {
	linux16 /boot/memtest86+x64.bin
}
fi
